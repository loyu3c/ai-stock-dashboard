# AI 股票波段選股小幫手 - 開發規劃書 (AI Stock Swing Assistant)

## 一、 專案目標

開發一套自動化系統，每日收盤後自動抓取數據、計算技術指標，並透過 AI 邏輯判定「紅綠燈信號」，最終將結果同步至 Google Sheets 與 Line，實現「免盯盤、直覺化」的波段操作策略。

## 二、 系統架構 (System Architecture)

### 1. 數據抓取層 (Data Layer)
*   **工具**: Python, Shioaji API
*   **功能**: 獲取全市場股票代號及歷史日 K 線資料。

### 2. 邏輯運算層 (Logic Layer)
*   **技術指標**: 使用 Pandas_TA 計算 MA, MACD, RSI, KD。
*   **紅綠燈邏輯**:
    *   🟢 **綠燈 (買進/強勢)**: 趨勢轉強、回測支撐、黃金交叉。
    *   🟡 **黃燈 (持有/觀望)**: 漲勢放緩、高檔震盪、等待信號。
    *   🔴 **紅燈 (賣出/轉弱)**: 跌破均線、死亡交叉、量縮走弱。

### 3. 數據中台 (Database Layer)
*   **工具**: Google Sheets API (gspread)
*   **功能**: 將結果寫入試算表，供網站前端讀取。

### 4. 通知與執行層 (Action Layer)
*   **第一個月**: Line Notify 推送紅綠燈警報 + 模擬交易紀錄。
*   **穩定後**: 自動執行下單指令。

## 三、 核心功能模組開發 (Python 實作方向)

### 1. 永豐金 API 數據對接 (Module: Data)
*   **功能**: 處理憑證登入、自動重連、批次下載歷史日 K。
*   **關鍵技術**: `shioaji.api`, `contracts_cb` 異步處理。

### 2. 技術指標與 AI 決策引擎 (Module: Analyzer)
*   **策略模型**:
    *   **進場策略 (綠燈)**: 當 $Price > MA(20)$ 且 $MACD$ 柱線轉正、 $KD$ 低檔金叉。
    *   **出場策略 (紅燈)**: 當 $Price < MA(10)$ 或 $RSI > 80$ 超買區回落。
*   **AI 強化**: 將過濾後的清單丟給 Gemini API，分析近三日籌碼變化（三大法人買賣超）給出最終信心評分。

### 3. Google Sheets 自動同步 (Module: Storage)
*   **欄位設計**:

| 股票代號 | 名稱 | 當前信號 | 信心評分 | 技術狀態描述 | 買入參考價 | 停損/利價 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| 2330 | 台積電 | 🟢 買進 | 92% | MA20 支撐強勁 | 1020 | 980 |

### 4. 紅綠燈直覺式介面 (Module: UI/UX)
*   **Google Sheets 色彩規則**: 設定條件格式（Conditional Formatting），讓試算表一眼望去呈現燈號顏色。
*   **Line 推送**: 每日 15:00 發送「今日燈號變動報表」。

## 四、 開發階段與時程

### 第一階段：基礎建設 (第 1-7 天)
- [ ] 完成 Google Cloud Project 設定，下載 `service_account.json`。
- [ ] 撰寫 Shioaji 自動登入腳本 (處理 pfx 憑證)。
- [ ] 實作單一股票 K 線抓取與 CSV 儲存。

### 第二階段：指標計算與燈號邏輯 (第 8-14 天)
- [ ] 整合 Pandas_TA 同時計算 MACD, RSI, KD, MA。
- [ ] 定義紅綠燈轉換邏輯（自訂判斷式）。
- [ ] 實作全市場（或特定清單）掃描器。

### 第三階段：雲端同步與模擬 (第 15-30 天)
- [ ] 串接 gspread 將掃描結果自動填入試算表。
- [ ] 開啟 Shioaji `simulation=True` 進行模擬下單。
- [ ] 建立 Line Notify 通知機制。

### 第四階段：優化與自動交易 (第 2 個月)
- [ ] 統計模擬交易勝率，調整燈號靈敏度。
- [ ] 開啟實盤自動交易（需確保風控邏輯：如單筆最大損益限制）。

## 五、 風險控管機制
*   **數據異常**: 若 API 抓不到數據，燈號會顯示「⚪ 數據缺失」並報警。
*   **網路中斷**: 本機端加上 Try-Except 循環重連機制。
*   **交易保護**: 自動交易模式下，設定每日總虧損 3% 即自動關閉下單功能。

## 開發備註
*   **本機開發環境**: Python 3.10+
*   **關鍵庫**: `shioaji`, `pandas_ta`, `gspread`, `google-auth`